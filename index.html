<!DOCTYPE html>
<html lang="es">
<head>

  <style>
  :root {
    --verde: #2e7d32;
    --rojo: #c62828;
    --gris: #f5f5f5;
    --texto: #222;
  }

  html, body {
  height: 100%;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background: linear-gradient(180deg, #f1f8f4 0%, #e8f5ee 100%);
  color: var(--texto);
  margin: 0;
  padding: 0;
  font-size: 50px;
  

}


  h2, h3 {
    margin-top: 0;
  }

  .card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(4px);
  border-radius: 16px;
  padding: 120px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  
}

  label {
    font-size: 0.85rem;
    margin-top: 12px;
    display: block;
    color: #555;
  }

  input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 1.1rem;
  }

  button {
    background: var(--verde);
    color: white;
    border: none;
    margin-top: 20px;
    font-weight: 600;
  }

  button:active {
    opacity: 0.9;
  }

  .resumen {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .resumen-item {
    font-size: 1.05rem;
  }

  .saldo {
    font-size: 1.4rem;
    font-weight: bold;
    margin-top: 12px;
  }

  .positivo {
    color: var(--verde);
  }

  .negativo {
    color: var(--rojo);
  }

  .app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 40px;
  padding: 100px;
  box-sizing: border-box;
  max-width: 1000px;
  margin: 0 auto;
}

</style>


<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2e7d32">

  <meta charset="UTF-8">
  <title>Control de Presupuesto</title>
  
</head>
<body>
  <div class="app">

<div class="card">
  <h3>Resumen mensual</h3>

  <select id="mesResumen"></select>

  <div class="resumen">
    <div class="resumen-item">Ingresos: $<span id="rIngresos"></span></div>
    <div class="resumen-item">Gastos fijos: $<span id="rFijos"></span></div>
    <div class="resumen-item">Gastos variables: $<span id="rVariables"></span></div>
    <div class="resumen-item">Deudas: $<span id="rDeudas"></span></div>
    <div class="resumen-item">Ahorro: $<span id="rAhorro"></span></div>
  </div>

  <div class="saldo" id="rSaldoContainer">
    Saldo: $<span id="rSaldo"></span>
  </div>
</div>


<div class="card">
  <h2>Nuevo movimiento</h2>

  <label>Tipo</label>
  <select id="tipo"></select>

  <label>Categoría</label>
  <select id="categoria"></select>

  <label>Medio de pago</label>
  <select id="medio"></select>

  <label>Fecha</label>
  <input type="date" id="fecha">

  <label>Monto</label>
  <input type="number" id="monto">

  <label>Descripción</label>
  <input id="descripcion">

  <button onclick="guardar()">Guardar</button>
</div>

  <p id="estado"></p>

<script>
const URL = "https://script.google.com/macros/s/AKfycbzw5RFY4jjxoAu_lC-gnk0vkqE2zei-beYYQ8UkXs7gbEWjx18tZGS4mkU76jD5Gew_XA/exec";

let categorias = [];
let medios = [];

fetch(URL)
  .then(res => res.json())
  .then(data => {
    categorias = data.categorias;
    medios = data.medios;
    cargarTipos();
    cargarCategorias();
    cargarMedios();
  });

document.getElementById("tipo").addEventListener("change", cargarCategorias);

function cargarCategorias() {
  const tipo = document.getElementById("tipo").value;
  const select = document.getElementById("categoria");

  select.innerHTML = "";

  categorias
    .filter(c => c.tipo === tipo)
    .forEach(c => {
      const option = document.createElement("option");
      option.value = c.nombre;
      option.textContent = c.nombre;
      select.appendChild(option);
    });
}


document.getElementById("fecha").valueAsDate = new Date();

function mesDesdeFecha(fecha) {
  const f = new Date(fecha);
  const meses = [
    "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
    "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
  ];
  return meses[f.getMonth()] + " " + f.getFullYear();
}

function guardar() {
  const tipo = document.getElementById("tipo").value;
  const categoria = document.getElementById("categoria").value;
  const fecha = document.getElementById("fecha").value;
  const monto = document.getElementById("monto").value;
  const descripcion = document.getElementById("descripcion").value;
  const medio = document.getElementById("medio").value;


  if (!categoria || !fecha || !monto) {
    alert("Faltan datos");
    return;
  }

  let hoja = "";
  let fila = [];

  const mes = mesDesdeFecha(fecha);

  if (tipo === "Ingreso") {
    hoja = "Ingresos";
    fila = [fecha, categoria, descripcion, Number(monto), mes];
  }

  if (tipo === "Gasto_Variable") {
    hoja = "Gastos_Variables";
    fila = [fecha, categoria, descripcion, Number(monto), medio, mes];
  }

  if (tipo === "Gasto_Fijo") {
    hoja = "Gastos_Fijos";
    fila = [fecha, categoria, Number(monto), medio, mes];
  }

  if (tipo === "Ahorro") {
    hoja = "Ahorro";
    fila = [fecha, categoria, descripcion, Number(monto), mes];
  }

  if (tipo === "Deuda") {
    hoja = "Deudas";
    fila = [fecha, categoria, "", Number(monto), medio, mes];
  }

  const data = new FormData();
  data.append("hoja", hoja);
  data.append("fila", JSON.stringify(fila));

  fetch(URL, {
    method: "POST",
    body: data
  })
  .then(r => r.text())
  .then(() => {
    document.getElementById("estado").innerText = "✔ Guardado";
  })
  .catch(() => {
    document.getElementById("estado").innerText = "❌ Error";
  });
}

function cargarMedios() {
  const select = document.getElementById("medio");
  select.innerHTML = "";

  medios.forEach(m => {
    const option = document.createElement("option");
    option.value = m;
    option.textContent = m;
    select.appendChild(option);
  });
}

function cargarResumen() {
  const mes = document.getElementById("mesResumen").value;

  fetch(URL + "?mes=" + encodeURIComponent(mes))
    .then(r => r.json())
    .then(data => {
      const r = data.resumen;
      if (!r) return;

      document.getElementById("rIngresos").innerText = r.ingresos;
      document.getElementById("rFijos").innerText = r.gastosFijos;
      document.getElementById("rVariables").innerText = r.gastosVariables;
      document.getElementById("rDeudas").innerText = r.deudas;
      document.getElementById("rAhorro").innerText = r.ahorro;
      document.getElementById("rSaldo").innerText = r.saldo;

      const saldoElem = document.getElementById("rSaldoContainer");
      saldoElem.classList.remove("positivo", "negativo");

      if (r.saldo >= 0) {
        saldoElem.classList.add("positivo");
      } else {
        saldoElem.classList.add("negativo");
      }
    });
}



function cargarMeses() {
  const select = document.getElementById("mesResumen");
  select.innerHTML = "";

  const hoy = new Date();
  const anio = hoy.getFullYear();

  const meses = [
    "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
    "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
  ];

  meses.forEach(m => {
    const option = document.createElement("option");
    option.value = `${m} ${anio}`;
    option.textContent = `${m} ${anio}`;
    select.appendChild(option);
  });

  select.value = mesDesdeFecha(hoy);
}

document.getElementById("mesResumen")
  .addEventListener("change", cargarResumen);

cargarMeses();
cargarResumen();

function cargarTipos() {
  const select = document.getElementById("tipo");
  select.innerHTML = "";

  const tipos = [
    { value: "Ingreso", label: "Ingreso" },
    { value: "Gasto_Fijo", label: "Gasto fijo" },
    { value: "Gasto_Variable", label: "Gasto variable" },
    { value: "Ahorro", label: "Ahorro" },
    { value: "Deuda", label: "Deuda" }
  ];

  tipos.forEach(t => {
    const option = document.createElement("option");
    option.value = t.value;
    option.textContent = t.label;
    select.appendChild(option);
  });
}



</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</div>
</body>
</html>















